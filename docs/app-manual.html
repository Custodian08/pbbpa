<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Руководство и разделы документации</title>
  <style>
    :root { --fg:#111; --bg:#fff; --muted:#666; --accent:#1677ff; }
    html, body { margin:0; padding:0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif; color:var(--fg); background:var(--bg); }
    header { padding:24px 20px; border-bottom:1px solid #eee; }
    main { padding:20px; max-width: 980px; margin: 0 auto; }
    h1 { margin: 0 0 8px; font-size: 24px; }
    h2 { margin-top: 28px; font-size: 20px; }
    h3 { margin-top: 22px; font-size: 18px; }
    nav { margin-top:8px; color: var(--muted); }
    nav a { color: var(--accent); text-decoration: none; margin-right: 12px; }
    section { margin: 18px 0 32px; }
    .placeholder { padding:12px 14px; background:#fafafa; border:1px dashed #ddd; border-radius:6px; color:#444; }
    code, pre { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; }
    pre { background:#0b1020; color:#e7eaf3; padding:12px; border-radius:6px; overflow:auto; }
    ul { margin: 8px 0 12px 22px; }
  </style>
</head>
<body>
  <header>
    <h1>Руководство по работе с программным приложением</h1>
    <nav>
      <a href="#sec-2-3">2.3</a>
      <a href="#sec-3-2">3.2. Архитектура</a>
      <a href="#sec-3-3">3.3</a>
      <a href="#sec-3-3-3-3">3.3.3.3. Технологии</a>
      <a href="#sec-4-1-reqs">4.1. Требования</a>
      <a href="#sec-4-3-1">4.3.1. Интерфейс</a>
      <a href="#sec-4-2">4.2. Варианты использования</a>
      <a href="#sec-4-3-3">4.3.3. Технологии</a>
      <a href="#sec-4-5">4.5. Руководство по работе</a>
      <a href="#sec-4-5-1">4.5.1. Руководство по установке</a>
      <a href="#sec-6">6. Перечень графического материала</a>
    </nav>
  </header>
  <main>
    <section id="sec-2-3">
      <h2>2.3. Постановка задачи на разработку программного средства</h2>

      <h3>Назначение</h3>
      <p>Программное средство создается для автоматизации управления фондом арендуемых помещений и взаимоотношениями с арендаторами: каталог помещений, резервации, договоры, биллинг, счета, платежи и аудит действий персонала. Система повышает эффективность работы, обеспечивает прозрачность процессов и предоставляет статистику, позволяющую отслеживать прогресс по заполненности фонда и дебиторской задолженности.</p>

      <h3>Цели создания программного средства</h3>
      <ul>
        <li>Создание единой системы учета и управления арендным бизнес‑процессом.</li>
        <li>Повышение качества (полноты, точности, согласованности, своевременности) данных и операций.</li>
        <li>Снижение ручного труда за счет автоматизации резерваций, биллинга и оформления счетов.</li>
        <li>Обеспечение контроля доступа (RBAC) и трассируемости через журналирование действий.</li>
        <li>Предоставление аналитики (дашборд, отчеты) для управленческих решений.</li>
      </ul>

      <h3>Цель курсового проекта</h3>
      <p>Разработка веб‑приложения, автоматизирующего ключевые этапы процесса аренды: от резервации помещения и заключения договора до выставления счетов и учета платежей, с поддержкой ролевой модели доступа и аудита.</p>

      <h3>Подход и архитектура</h3>
      <ul>
        <li>Клиент‑серверная архитектура: SPA (React + TypeScript) ↔ REST API (NestJS) ↔ БД (PostgreSQL, Prisma ORM).</li>
        <li>Аутентификация JWT (httpOnly‑cookie), авторизация по ролям (RBAC), аудит ключевых операций.</li>
        <li>Миграции БД (Prisma Migrate), генерация PDF (счета; договоры при необходимости), импорт/экспорт CSV/Excel.</li>
      </ul>

      <h3>Роли и ключевые задачи (MUST)</h3>
      <ul>
        <li><strong>Администратор</strong>: управление пользователями и ролями; доступ к настройкам и журналам аудита; операции жизненного цикла договоров.</li>
        <li><strong>Бухгалтер</strong>: биллинг за период; оформление счетов; импорт и разнесение платежей; контроль статусов счетов.</li>
        <li><strong>Оператор</strong>: ведение справочников «Помещения/Арендаторы»; резервации; создание и сопровождение договоров.</li>
        <li><strong>Пользователь (арендатор)</strong>: просмотр каталога; создание и отмена собственной резервации; личный кабинет «Мои *» (договоры, счета, платежи, резервации).</li>
        <li><strong>Менеджер/Руководство</strong>: просмотр дашборда и отчетов, мониторинг KPI.</li>
      </ul>

      <h3>В приложении необходимо реализовать</h3>
      <ul>
        <li>Аутентификацию и авторизацию с разграничением прав доступа к админ‑панели (только Администратор).</li>
        <li>Каталог помещений и операции резервации: пользователь «Зарезервировать»; персонал — управление/отмена.</li>
        <li>Создание и ведение договоров аренды; при необходимости — генерация PDF договора и загрузка подписанного файла.</li>
        <li>Биллинг за период: формирование начислений и счетов для активных договоров; скачивание счетов в PDF.</li>
        <li>Учет платежей: импорт из CSV/Excel, сопоставление со счетами, перерасчет статусов.</li>
        <li>Аудит действий пользователей и ключевых бизнес‑операций.</li>
        <li>Личный кабинет пользователя: «Мои договоры», «Мои счета», «Мои платежи», «Мои резервации».</li>
      </ul>

      <h3>Задачи первого этапа (MUST)</h3>
      <ul>
        <li><strong>Пользователи и роли</strong>: создание пользователей Администратором; назначение ролей (Admin, Accountant, Operator, User); вход в систему.</li>
        <li><strong>Каталог и резервации</strong>: публикация карточек помещений; бронирование пользователем; отмена собственной брони; отмена/управление бронями персоналом.</li>
        <li><strong>Договоры</strong>: создание/редактирование; контроль периодов (без пересечений); смена статусов; генерация/загрузка PDF (по необходимости).</li>
        <li><strong>Биллинг и счета</strong>: запуск биллинга за период; оформление счетов; скачивание счетов в PDF.</li>
        <li><strong>Платежи</strong>: импорт CSV/Excel; сопоставление со счетами; перерасчет статусов счетов.</li>
        <li><strong>Аудит</strong>: журналирование CRUD и ключевых операций; фильтрация по пользователю/дате/объекту.</li>
      </ul>

      <h3>Задачи последующих этапов (SHOULD/COULD)</h3>
      <ul>
        <li>Интеграции с банковскими API для автоматического импорта платежей.</li>
        <li>Уведомления по e‑mail (SMTP) о счетах и статусах операций.</li>
        <li>Электронное подписание договоров и обмен документами.</li>
        <li>Расширенные отчеты и дашборды (заполняемость, дебиторка, DSO, пени).</li>
        <li>Мобильная/адаптивная оптимизация интерфейса.</li>
      </ul>

      <h3>Ожидаемые результаты и критерии приемки</h3>
      <ul>
        <li>Пользователь может забронировать помещение и отменить собственную активную бронь; персонал управляет бронями.</li>
        <li>Создаются договоры без пересечения периодов по одному помещению; статусы договоров корректно меняют статус помещения.</li>
        <li>Биллинг формирует начисления и счета за заданный период; счета доступны для скачивания в PDF.</li>
        <li>Импортированные платежи сопоставляются со счетами; статусы счетов пересчитываются.</li>
        <li>Раздел «Администрирование» доступен только Администратору; все ключевые операции пишутся в аудит.</li>
      </ul>

      <h3>Границы и допущения</h3>
      <ul>
        <li>В v1 регистрация пользователей выполняется Администратором; публичная саморегистрация опциональна.</li>
        <li>Онлайн‑оплаты и прямые банковские интеграции не входят в первоначальный объем.</li>
        <li>Поддерживаются современные браузеры (Chromium/Firefox/Edge); Internet Explorer не поддерживается.</li>
      </ul>
    </section>
    <section id="sec-3-2">
      <h2>3.2. Выбор и обоснование архитектуры программного приложения</h2>

      <p>Архитектура приложения — это общее устройство системы: из каких частей она состоит, как эти части взаимодействуют и какие свойства (надежность, безопасность, масштабируемость) мы хотим обеспечить. Наша цель — сделать систему, которую удобно развивать и эксплуатировать: чтобы её было легко настраивать (например, менять НДС или ставку пени), наблюдать (логи и метрики), переносить между средами и масштабировать при росте нагрузки.</p>

      <h3>Вводная и определения</h3>
      <ul>
        <li><strong>Клиент‑сервер</strong> — браузер (клиент) обращается к серверу по HTTP. Клиент отвечает за интерфейс, сервер — за правила и данные.</li>
        <li><strong>Слоистая модель</strong> — разделение на уровни: UI, API, бизнес‑логика (доменные сервисы), доступ к данным, база данных.</li>
        <li><strong>Монолит</strong> на первом этапе — один сервис, внутри которого есть фоновые задания; упрощает запуск и поддержку.</li>
        <li><strong>Фоновые задания</strong> — отложенные или регулярные операции (импорт, биллинг), которые не мешают работе пользователей.</li>
      </ul>

      <h3>Описание выбранной архитектуры</h3>
      <ul>
        <li><strong>UI (SPA на React)</strong>: быстрый интерфейс в браузере без установок.</li>
        <li><strong>API (NestJS)</strong>: единая точка входа для всех действий — резервации, договоры, счета, платежи.</li>
        <li><strong>Доменные сервисы</strong>: инкапсулируют правила биллинга, индексаций, пеней, статусов договоров.</li>
        <li><strong>Доступ к данным</strong>: ORM управляет чтением/записью и целостностью данных.</li>
        <li><strong>PostgreSQL</strong>: надежная реляционная БД с хорошей поддержкой отчетности.</li>
      </ul>

      <h3>Потоки данных</h3>
      <ul>
        <li>Пользователь → UI → REST API → доменные сервисы → ORM → PostgreSQL.</li>
        <li>Расписание (таймер) → доменные сервисы → расчеты начислений/счетов → запись в БД.</li>
        <li>Импорт (CSV/Excel) → проверка → временные таблицы → сопоставление → основные записи.</li>
      </ul>

      <h3>Состав компонентов</h3>
      <ul>
        <li><strong>API‑шлюз</strong> (REST‑контроллеры).</li>
        <li><strong>Доменные сервисы</strong> (Начисления, Индексации, Пени, Договоры/Статусы).</li>
        <li><strong>Импорт</strong> (CSV/Excel), <strong>Сопоставление платежей</strong>, <strong>Уведомления</strong> (e‑mail), <strong>Аналитика</strong> (представления и витрины KPI).</li>
      </ul>

      <h3>Почему веб‑приложение (SPA + API)</h3>
      <ul>
        <li>Доступ из браузера без установки, удобно для сотрудников и клиентов.</li>
        <li>Масштабирование: одновременно работают многие пользователи.</li>
        <li>Быстрое обновление: выкатываем новую версию на сервере, без действий на рабочих местах.</li>
      </ul>

      <h3>Выбранный стиль и состав</h3>
      <ul>
        <li>Клиент‑сервер: UI — React (SPA), сервер — REST API на NestJS (Node.js), база — PostgreSQL.</li>
        <li>Чёткое разделение: интерфейс, бизнес‑логика, данные. Это упрощает поддержку и развитие.</li>
        <li>Долгие операции (импорт, расчёты) выполняются в фоновых заданиях, чтобы не мешать пользователям.</li>
      </ul>

      <h3>Развёртывание и масштабирование</h3>
      <ul>
        <li>По умолчанию: единый бэкенд‑сервис (API + фоновые задачи) и статический фронтенд; база — отдельный сервер PostgreSQL.</li>
        <li>Возможна контейнеризация (Docker) и размещение on‑prem или в облаке; горизонтальное масштабирование API через балансировщик.</li>
      </ul>

      <h3>Безопасность и наблюдаемость</h3>
      <ul>
        <li>Аутентификация через токены (JWT) и роли (RBAC), журнал действий (аудит).</li>
        <li>Централизованные логи и базовые метрики для контроля стабильности.</li>
        <li>Настройки (например, НДС/пени) хранятся в конфигурации и могут меняться без переработки кода.</li>
      </ul>

      <h3>Альтернативы и отказ от них</h3>
      <ul>
        <li><strong>Микросервисы</strong> — сложнее в управлении на старте; планируем монолит с возможностью выделения модулей (импорт/аналитика) позже.</li>
        <li><strong>.NET/Java</strong> — сильные платформы; выбрали Node/NestJS из‑за скорости разработки и компетенций команды.</li>
        <li><strong>MySQL</strong> — уступает PostgreSQL для аналитических задач и витрин; оставляем PostgreSQL.</li>
      </ul>

      <h3>Таблица 3.1 – Сравнительный анализ программных платформ</h3>
      <table border="1" cellspacing="0" cellpadding="6" style="border-collapse:collapse; width:100%">
        <thead style="background:#fafafa">
          <tr>
            <th>Характеристика</th>
            <th>NestJS (Node.js)</th>
            <th>ASP.NET Core (.NET)</th>
            <th>Spring Boot (Java)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Документация и сообщество</td>
            <td>Широкое сообщество, понятные примеры</td>
            <td>Очень полная документация, зрелые гайды</td>
            <td>Зрелая экосистема, множество материалов</td>
          </tr>
          <tr>
            <td>Масштабируемость</td>
            <td>Легко масштабируется горизонтально</td>
            <td>Хорошо масштабируется в enterprise‑среде</td>
            <td>Подходит для крупных систем</td>
          </tr>
          <tr>
            <td>Шаблоны/экосистема</td>
            <td>Много готовых модулей и библиотек</td>
            <td>Шаблоны и инструменты из коробки</td>
            <td>Большое количество стартеров и зависимостей</td>
          </tr>
          <tr>
            <td>Отладка и скорость разработки</td>
            <td>Быстрые циклы разработки</td>
            <td>Хорошие инструменты, но чуть тяжелее старт</td>
            <td>Мощно, но требует опыта</td>
          </tr>
          <tr>
            <td>Производительность</td>
            <td>Достаточная для нашего сценария</td>
            <td>Высокая</td>
            <td>Высокая</td>
          </tr>
        </tbody>
      </table>
      <p><em>Вывод:</em> все варианты подходят, но для быстрого старта и удобства команды выбираем NestJS (Node.js) — проще запуск, много готовых решений и хорошая скорость разработки.</p>

      <h3>Таблица 3.2 – Сравнительный анализ серверных фреймворков</h3>
      <table border="1" cellspacing="0" cellpadding="6" style="border-collapse:collapse; width:100%">
        <thead style="background:#fafafa">
          <tr>
            <th>Характеристика</th>
            <th>NestJS</th>
            <th>ASP.NET Core</th>
            <th>Spring Boot</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Архитектурный стиль</td>
            <td>Модульная структура, REST</td>
            <td>Слойная архитектура, REST</td>
            <td>Слойная архитектура, REST</td>
          </tr>
          <tr>
            <td>Работа с БД</td>
            <td>ORM Prisma или TypeORM</td>
            <td>EF Core</td>
            <td>Spring Data (JPA)</td>
          </tr>
          <tr>
            <td>Клиентский UI</td>
            <td>Легко сочетается с React/SPA</td>
            <td>Легко сочетается с React/SPA</td>
            <td>Легко сочетается с React/SPA</td>
          </tr>
          <tr>
            <td>Фоновые задачи</td>
            <td>Планировщики и очереди при необходимости</td>
            <td>Встроенные фоновые сервисы</td>
            <td>Scheduler/Batch‑механизмы</td>
          </tr>
          <tr>
            <td>Кроссплатформенность</td>
            <td>Windows/Linux/macOS, Docker</td>
            <td>Windows/Linux, Docker</td>
            <td>Windows/Linux/macOS, Docker</td>
          </tr>
        </tbody>
      </table>
      <p><em>Вывод:</em> все три фреймворка решают задачу. Мы отдаем приоритет NestJS благодаря простой модульности, удобной работе с SPA и быстрой разработке.</p>

      <h3>Итого: выбранная архитектура</h3>
      <ul>
        <li>UI: React (SPA). API: NestJS (Node.js). База: PostgreSQL.</li>
        <li>Монолитный бэкенд c фоновыми заданиями для импорта и расчётов.</li>
        <li>Запас по росту: при необходимости отдельные части (импорт/аналитика) можно выделить позже.</li>
      </ul>
    </section>
    <section id="sec-3-3">
      <h2>3.3</h2>
      <div class="placeholder">
        <strong>Заглушка раздела 3.3.</strong>
        <div>Пожалуйста, пришлите текст 3.3 — я вставлю его сюда без изменений. При необходимости можно добавить подпункты и иллюстрации.</div>
      </div>
    </section>

    <section id="sec-3-3-3-3">
      <h2>3.3.3.3. Выбор и обоснование технологий для реализации программного приложения</h2>

      <p>Ниже перечислены ключевые технологии, которые мы используем на фронтенде, бэкенде и в базе данных. Для каждой указано, почему она подходит и как именно будет применяться в проекте. Также приведены краткие таблицы сравнения с альтернативами и выводы по выбору.</p>

      <h3>Frontend</h3>
      <ul>
        <li><strong>React + TypeScript</strong> — библиотека для SPA и статическая типизация.
          <br><em>Обоснование:</em> зрелая экосистема, компонентный подход, высокая продуктивность, типобезопасность.
          <br><em>Как применяем:</em> модульная архитектура (страницы/виджеты/формы), типы для DTO API, React Router (ProtectedRoute/StaffRoute), хуки состояния/эффектов.
        </li>
        <li><strong>Ant Design</strong> — UI‑компоненты (таблицы, формы, модальные окна, навигация).
          <br><em>Обоснование:</em> богатые enterprise‑компоненты, единый дизайн, большие таблицы.
          <br><em>Как применяем:</em> таблицы с пагинацией/фильтрами, Form с валидацией, Drawer/Modal для мастеров и карточек.
        </li>
        <li><strong>React Query</strong> — кэширование и синхронизация данных.
          <br><em>Почему:</em> кэш, повторы, статусы, оптимистичные апдейты.
          <br><em>Как применяем:</em> запросы к REST API, инвалидация кеша после мутаций (catalog, me.reservations, invoices, payments), фоновое обновление.
        </li>
        <li><strong>Recharts/ECharts</strong> — графики и диаграммы.
          <br><em>Обоснование:</em> Line/Bar/Stacked/Pie/Heatmap, производительность и кастомизация.
          <br><em>Как применяем:</em> дашборд и отчёты (доход, заполняемость, aging, DSO, индексации).
        </li>
        <li><strong>Vite</strong> — современный сборщик/dev‑сервер.
          <br><em>Обоснование:</em> быстрые сборки и HMR, простая конфигурация.
          <br><em>Как применяем:</em> сборка SPA, dev/prod конфиги, алиасы путей.
        </li>
      </ul>

      <h4>Таблица 3.3 — Сравнение фронтенд‑фреймворков</h4>
      <table border="1" cellspacing="0" cellpadding="6" style="border-collapse:collapse; width:100%">
        <thead style="background:#fafafa">
          <tr>
            <th>Критерий</th>
            <th>React</th>
            <th>Angular</th>
            <th>Vue</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Документация/сообщество</td>
            <td>Очень широкие</td>
            <td>Полные, но сложнее вход</td>
            <td>Хорошие и компактные</td>
          </tr>
          <tr>
            <td>Скорость разработки</td>
            <td>Высокая</td>
            <td>Средняя</td>
            <td>Высокая</td>
          </tr>
          <tr>
            <td>Экосистема компонентов</td>
            <td>Большая (AntD и др.)</td>
            <td>Много, но тесно связано с экосистемой Angular</td>
            <td>Достаточно для большинства задач</td>
          </tr>
          <tr>
            <td>Кривая обучения</td>
            <td>Низкая/средняя</td>
            <td>Выше средней</td>
            <td>Низкая</td>
          </tr>
        </tbody>
      </table>
      <p><em>Вывод:</em> выбираем React из‑за скорости разработки, экосистемы компонентов и опыта команды.</p>

      <h3>Backend</h3>
      <ul>
        <li><strong>NestJS (TypeScript)</strong> — фреймворк для модульных REST‑сервисов.
          <br><em>Обоснование:</em> структура (controllers/services/guards), DI, тестируемость.
          <br><em>Как применяем:</em> модули (reservations, checkout, billing, payments, reports), guards с <code>@Roles</code>, pipes с <code>class-validator</code>, interceptors/filters.
        </li>
        <li><strong>Prisma ORM (PostgreSQL)</strong> — слой доступа к БД.
          <br><em>Обоснование:</em> скорость разработки, статические типы, миграции, удобные связи.
          <br><em>Как применяем:</em> schema.prisma, отношения User/Tenant/Premise/Lease/Reservation/Invoice/Payment, проверки целостности.
        </li>
        <li><strong>PDFKit</strong> — генерация PDF (счета/акты).
          <br><em>Обоснование:</em> гибкая отрисовка и контроль шрифтов.
          <br><em>Как применяем:</em> шрифты с кириллицей (Arial/DejaVu), корректная потоковая отдача.
        </li>
        <li><strong>ExcelJS/CSV</strong> — импорт/экспорт табличных данных.
          <br><em>Обоснование:</em> распространённые форматы обмена.
          <br><em>Как применяем:</em> экспорт XLSX/CSV, шаблоны импорта, парсинг загрузок, протокол ошибок.
        </li>
        <li><strong>Multer</strong> — загрузка файлов.
          <br><em>Обоснование:</em> простая интеграция с NestJS.
          <br><em>Как применяем:</em> endpoints загрузки/скачивания, хранение метаданных.
        </li>
        <li><strong>Nodemailer</strong> — e‑mail уведомления (при наличии SMTP).
          <br><em>Обоснование:</em> распространённое решение.
          <br><em>Как применяем:</em> отправка уведомлений о счетах/событиях при включенной конфигурации.
        </li>
      </ul>

      <h4>Таблица 3.4 — Сравнение серверных платформ</h4>
      <table border="1" cellspacing="0" cellpadding="6" style="border-collapse:collapse; width:100%">
        <thead style="background:#fafafa">
          <tr>
            <th>Критерий</th>
            <th>NestJS</th>
            <th>ASP.NET Core</th>
            <th>Spring Boot</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Скорость старта</td>
            <td>Быстро</td>
            <td>Средне</td>
            <td>Средне</td>
          </tr>
          <tr>
            <td>Кроссплатформенность</td>
            <td>Высокая</td>
            <td>Высокая</td>
            <td>Высокая</td>
          </tr>
          <tr>
            <td>Опыт команды</td>
            <td>Высокий</td>
            <td>Средний</td>
            <td>Средний</td>
          </tr>
          <tr>
            <td>Экосистема ORM</td>
            <td>Prisma/TypeORM</td>
            <td>EF Core</td>
            <td>Spring Data (JPA)</td>
          </tr>
        </tbody>
      </table>
      <p><em>Вывод:</em> используем NestJS благодаря скорости разработки и компетенциям, при этом архитектура сохраняет переносимость.</p>

      <h3>База данных</h3>
      <ul>
        <li><strong>PostgreSQL 14+</strong> — реляционная СУБД.
          <br><em>Обоснование:</em> транзакционность, мощный SQL, индексы/partitions, материализованные представления.
          <br><em>Как применяем:</em> схема 3НФ (справочники/факты), индексы по договорам/периодам, внешние ключи.
        </li>
        <li><strong>Миграции (Prisma Migrate)</strong>.
          <br><em>Почему:</em> управляемые изменения схемы с историей.
          <br><em>Как применяем:</em> версионирование изменений, prisma migrate/db push, seed‑данные.
        </li>
      </ul>

      <h4>Таблица 3.5 — Сравнение СУБД</h4>
      <table border="1" cellspacing="0" cellpadding="6" style="border-collapse:collapse; width:100%">
        <thead style="background:#fafafa">
          <tr>
            <th>Критерий</th>
            <th>PostgreSQL</th>
            <th>MySQL</th>
            <th>MS SQL Server</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Лицензирование</td>
            <td>Открытая</td>
            <td>Открытая</td>
            <td>Коммерческая (основная)</td>
          </tr>
          <tr>
            <td>Аналитические функции</td>
            <td>Сильные (CTE, оконные, матвью)</td>
            <td>Базовые</td>
            <td>Сильные</td>
          </tr>
          <tr>
            <td>JSON/расширяемость</td>
            <td>Хорошая</td>
            <td>Хорошая</td>
            <td>Хорошая</td>
          </tr>
        </tbody>
      </table>
      <p><em>Вывод:</em> PostgreSQL — оптимальный баланс возможностей, стоимости и совместимости с нашим стеком.</p>

      <h3>Интеграции и файлы</h3>
      <ul>
        <li><strong>CSV/Excel</strong>: шаблоны импорта, парсинг, протокол ошибок.</li>
        <li><strong>DOCX</strong>: генерация документов по шаблонам (при необходимости).</li>
        <li><strong>PDF</strong>: счета/акты с поддержкой кириллицы.</li>
      </ul>

      <h3>Безопасность и доступ</h3>
      <ul>
        <li><strong>JWT/куки‑аутентификация</strong>: совместимо со SPA, не требует постоянных сессий на сервере.</li>
        <li><strong>RBAC</strong>: роли USER/OPERATOR/MANAGER/ADMIN и политики доступа на действия.</li>
        <li><strong>Аудит</strong>: журналирование CRUD и ключевых событий (счета, платежи, операции с договорами).</li>
      </ul>
    </section>

    <section id="sec-4-1-reqs">
      <h2>4.1. Разработка требований. Спецификация функциональных и нефункциональных требований</h2>

      <h3>Функциональные требования (Must, согласованы с use case 4.2)</h3>
      <table border="1" cellspacing="0" cellpadding="6" style="border-collapse:collapse; width:100%">
        <thead style="background:#fafafa">
          <tr>
            <th>Код требования</th>
            <th>Роль</th>
            <th>Название</th>
            <th>Описание</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>F001</td>
            <td>Админ</td>
            <td>Разграничение прав доступа к панели администрирования</td>
            <td>Система должна разграничивать доступ к разделам «Пользователи», «Настройки», «Аудит» ролям. Данную настройку должна видеть только роль Админа. Связь с UC: UC-Adm1, UC-Adm2, UC-Adm3.</td>
          </tr>
          <tr>
            <td>F002</td>
            <td>Админ, бухгалтер</td>
            <td>Управление резервациями помещений</td>
            <td>Система должна давать возможность отменять резервацию квартиры. Связь с UC: UC-Ac2, UC-O2.</td>
          </tr>
          <tr>
            <td>F003</td>
            <td>Пользователь</td>
            <td>Резервация помещения</td>
            <td>Система должна давать возможность клиенту зарезервировать нужную квартиру при нажатии кнопки «Зарезервировать». Связь с UC: UC-U2.</td>
          </tr>
          <tr>
            <td>F004</td>
            <td>Админ, бухгалтер</td>
            <td>Создание и ведение договоров аренды</td>
            <td>Система должна давать возможность создать готовый договор PDF при нажатии на кнопку «Договор» в разделе «Договоры». Связь с UC: UC-Ac5, UC-Adm4.</td>
          </tr>
          <tr>
            <td>F005</td>
            <td>Админ, бухгалтер</td>
            <td>Биллинг за период</td>
            <td>Система должна давать возможность формировать начисления и счета для договоров за выбранный период. Связь с UC: UC-Ac6, UC-O6, UC-S1.</td>
          </tr>
          <tr>
            <td>F006</td>
            <td>Админ, бухгалтер</td>
            <td>Создание предложения об аренде квартиры</td>
            <td>Система должна давать возможность создать предложение о квартире в меню «Каталог» (публикация карточки помещения). Связь с UC: UC-O3.</td>
          </tr>
          <tr>
            <td>F007</td>
            <td>Админ</td>
            <td>Аудит действий пользователей</td>
            <td>Система должна давать возможность администратору просматривать аудит действий пользователей. Связь с UC: UC-Adm2.</td>
          </tr>
          <tr>
            <td>F008</td>
            <td>Админ, бухгалтер</td>
            <td>Оформление счетов</td>
            <td>Система должна давать возможность оформить счет. Связь с UC: UC-O7, UC-Ac6.</td>
          </tr>
        </tbody>
      </table>

      <h3>Нефункциональные требования</h3>
      <table border="1" cellspacing="0" cellpadding="6" style="border-collapse:collapse; width:100%">
        <thead style="background:#fafafa">
          <tr>
            <th>Код</th>
            <th>Название</th>
            <th>Описание</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>NF01</td>
            <td>Безопасность. Аутентификация и RBAC</td>
            <td>JWT в httpOnly‑куках, хэширование паролей (bcrypt), роль‑бэйзд доступ к эндпоинтам/меню, защита от прямого доступа к админ‑панели.</td>
          </tr>
          <tr>
            <td>NF02</td>
            <td>Производительность списков</td>
            <td>Серверная пагинация/фильтрация; время отклика списков до 1 секунды при объёме до 100 записей на страницу.</td>
          </tr>
          <tr>
            <td>NF03</td>
            <td>Надёжность данных</td>
            <td>Транзакции при критичных операциях (бронь, смена статуса помещения, активация договора), внешние ключи и уникальные ограничения в БД.</td>
          </tr>
          <tr>
            <td>NF04</td>
            <td>Журналирование и трассируемость</td>
            <td>Аудит действий пользователей; хранение метаданных события; фильтрация по пользователю/дате/действию.</td>
          </tr>
          <tr>
            <td>NF05</td>
            <td>Юзабилити и доступность</td>
            <td>Единые UX‑паттерны (таблицы/формы/диалоги), поддержка клавиатурной навигации, контрастность, понятные сообщения об ошибках.</td>
          </tr>
          <tr>
            <td>NF06</td>
            <td>Совместимость</td>
            <td>Поддержка современных браузеров (Chromium/Firefox/Edge), сервер Node.js 18+, БД PostgreSQL 14+.</td>
          </tr>
          <tr>
            <td>NF07</td>
            <td>Масштабируемость</td>
            <td>Возможность горизонтального масштабирования API; идемпотентность базовых операций импорта; кэш запросов на клиенте.</td>
          </tr>
          <tr>
            <td>NF08</td>
            <td>Резервное копирование и миграции</td>
            <td>Использование миграций Prisma; регулярный бэкап БД на уровне СУБД.</td>
          </tr>
        </tbody>
      </table>

      <h3>Трассировка F → UC (фрагмент)</h3>
      <ul>
        <li>F001 → UC-Adm1, UC-Adm2, UC-Adm3</li>
        <li>F002 → UC-Ac2, UC-O2</li>
        <li>F003 → UC-U2</li>
        <li>F004 → UC-Ac5, UC-Adm4</li>
        <li>F005 → UC-Ac6, UC-O6, UC-S1</li>
        <li>F006 → UC-O3</li>
        <li>F007 → UC-Adm2</li>
        <li>F008 → UC-O7, UC-Ac6</li>
      </ul>
    </section>

    <section id="sec-4-3-1">
      <h2>4.3.1. Проектирование интерфейса программного приложения</h2>

      <h3>Общий каркас</h3>
      <ul>
        <li><strong>Лейаут</strong>: фиксированный верхний бар (логотип, название, быстрый поиск, иконки уведомлений/профиля) + левое боковое меню.</li>
        <li><strong>Основная область</strong>: контент с вторичной панелью фильтров справа/сверху (по экрану).</li>
        <li><strong>Тема</strong>: светлая по умолчанию, поддержка тёмной темы.</li>
      </ul>

      <h3>Навигация (страницы)</h3>
      <ul>
        <li><strong>Дашборд</strong> (для персонала).</li>
        <li><strong>Каталог</strong> (для всех пользователей).</li>
        <li><strong>Резервации</strong> (персонал; для USER — раздел «Мои резервации»).</li>
        <li><strong>Помещения</strong> (персонал).</li>
        <li><strong>Арендаторы</strong> (персонал).</li>
        <li><strong>Договоры</strong> (персонал; индексации и документы — внутри карточки договора).</li>
        <li><strong>Счета</strong> (персонал; запуск биллинга).</li>
        <li><strong>Платежи</strong> (персонал; импорт/разнесение/возвраты).</li>
        <li><strong>Администрирование</strong> (только ADMIN): Пользователи, Настройки, Аудит.</li>
        <li><strong>Личный кабинет</strong> (USER): Мои договоры, Мои счета, Мои платежи, Мои резервации.</li>
      </ul>

      <h3>Общие паттерны</h3>
      <ul>
        <li><strong>Таблицы</strong>: серверная пагинация, сортировка, многостолбцовые фильтры; сохранение пресетов.</li>
        <li><strong>Формы</strong>: пошаговые мастера; валидация полей; маски УНП/IBAN; недоступные кнопки до валидности.</li>
        <li><strong>Диалоги</strong>: подтверждения, деструктивные операции, отчёт об ошибках импорта.</li>
        <li><strong>Уведомления</strong>: тосты об успехе/ошибке; баннеры ошибок; скелетоны загрузки; пустые состояния с подсказками.</li>
        <li><strong>Экспорт</strong>: Excel/CSV, PDF (счета/акты).</li>
        <li><strong>RBAC</strong>: ограничения действий и видимости пунктов меню по ролям (Admin/Operator/Accountant/User/... ).</li>
        <li><strong>Доступность</strong>: контрастность, aria‑атрибуты, управление с клавиатуры.</li>
      </ul>

      <h3>Экран: Дашборд (Главная)</h3>
      <ul>
        <li><strong>Виджеты</strong>: KPI (Заполняемость %, Доход base/total, Дебиторка, DSO, Пени), «Доход по месяцам», «Заполняемость по типам», матрица Aging, «Средняя ставка и индексации» (Line с событиями), «Топ‑N должников», карта статусов помещений.</li>
        <li><strong>Фильтры</strong>: период, объект/здание, тип помещения, арендатор.</li>
        <li><strong>Действия</strong>: сохранить пресет, экспорт, drill‑down в договор/помещение/платёж.</li>
        <li><strong>Состояния</strong>: скелетоны, «нет данных», отметка времени последнего обновления.</li>
      </ul>

      <h3>Экран: Каталог</h3>
      <ul>
        <li><strong>Список карточек помещений</strong>: код, адрес, тип, площадь, ставка (тип/значение), статус (для персонала).</li>
        <li><strong>Действия</strong>: «Забронировать»; «Арендовать и оплатить» (checkout: создаёт договор + счёт и проводит оплату).</li>
        <li><strong>Фильтры</strong>: по роли — персонал видит все; USER видит только доступные.</li>
      </ul>

      <h3>Экран: Резервации</h3>
      <ul>
        <li><strong>Список</strong>: помещение, период до, статус, кто создал.</li>
        <li><strong>Действия</strong>: создать/отменить (персонал), отменить свою (USER).</li>
      </ul>

      <h3>Экран: Справочник «Помещения»</h3>
      <ul>
        <li><strong>Список</strong>: Код, Адрес/Объект, Этаж, Площадь (м²), Тип, Базовая ставка, Статус, «Доступно с»; фильтры по типу/статусу/площади/объекту; массовые операции (экспорт, смена статуса).</li>
        <li><strong>Карточка</strong>: Профиль, Фото/план БТИ, История статусов, Связанные договоры, Показатели (мини‑KPI).</li>
        <li><strong>Валидации</strong>: уникальность кода; обязательные тип/площадь/адрес; запрет статуса «сдано» вне контекста договора.</li>
      </ul>

      <h3>Экран: Справочник «Арендаторы»</h3>
      <ul>
        <li><strong>Список</strong>: Наименование, УНП, Контакты, Банковские реквизиты, Активные договоры, Долг; фильтры по УНП/названию/статусу.</li>
        <li><strong>Карточка</strong>: Реквизиты, Контакты, Договоры, Платежи, Акты сверки, Просрочки.</li>
      </ul>

      

      <h3>Экран: «Договоры»</h3>
      <ul>
        <li><strong>Список</strong>: Номер, Арендатор, Помещение, Период, База тарификации, Ставка, НДС, Срок оплаты, Депозит, Статус.</li>
        <li><strong>Мастер создания</strong>: 1) выбор помещения/арендатора; 2) параметры (ставка, НДС, срок оплаты, депозит, пени, индексации); 3) документы (генерация/загрузка); 4) подписание; 5) итог.</li>
        <li><strong>Карточка</strong>: Сводка, Условия, Документы (договор, допсоглашения), Акты, Начисления/Счета, Платежи, Статусы, История; действия: пролонгация, изменение условий, расторжение, экспорт.</li>
        <li><strong>Валидации</strong>: пересечение периодов по одному помещению; обязательные поля; согласованность НДС.</li>
      </ul>

      <h3>Экран: «Счета»</h3>
      <ul>
        <li><strong>Список счетов</strong>: номер, дата, договор/арендатор, сумма, статус; фильтры по периоду/статусу/поиску.</li>
        <li><strong>Действия</strong>: запуск биллинга за период, скачивание PDF, экспорт.</li>
      </ul>

      <h3>Экран: «Платежи (импорт и разнесение)»</h3>
      <ul>
        <li><strong>Импорт</strong>: загрузка CSV/Excel, выбор шаблона, предпросмотр, протокол ошибок.</li>
        <li><strong>Авторазнесение</strong>: таблица сопоставления «Платёж → Счёт/Договор/Назначение/Сумма/Дата»; статусы «разнесён/частично/требует внимания»; ручное сопоставление; возвраты/перерасчёты.</li>
      </ul>

      

      <h3>Экран: «Администрирование — Пользователи/Роли»</h3>
      <ul>
        <li><strong>Пользователи</strong>: логин, ФИО, роли, статус, последний вход; действия: создать/деактивировать, сброс пароля, назначить роли.</li>
        <li><strong>Роли/права</strong>: матрица CRUD и доступов к отчётам/импорту.</li>
      </ul>

      <h3>Экран: «Администрирование — Настройки»</h3>
      <ul>
        <li><strong>Параметры</strong>: НДС (по умолчанию), ставка пени, срок оплаты, шаблоны импорта, SMTP; валидации диапазонов; тест‑отправка писем.</li>
      </ul>

      <h3>Экран: «Аудит и Журналы»</h3>
      <ul>
        <li><strong>Журнал действий</strong>: время, пользователь, объект, действие, результат; фильтры по актору/типу/дате; экспорт.</li>
        <li><strong>Журнал уведомлений</strong>: тип, получатель, статус доставки, ретраи.</li>
      </ul>

      

      <h3>Экран: «Личный кабинет — Мои *»</h3>
      <ul>
        <li><strong>Страницы</strong>: Мои договоры, Мои счета, Мои платежи, Мои резервации.</li>
        <li><strong>Доступ</strong>: только USER; данные фильтруются по tenantId/owner.</li>
      </ul>

      <h3>Состояния, валидация, доступность</h3>
      <ul>
        <li><strong>Загрузка/ошибки</strong>: скелетоны, retry, сообщения об ошибках с кодами и ссылкой на журнал.</li>
        <li><strong>Валидации</strong>: обязательные поля, маски УНП/IBAN, проверки дат/пересечений.</li>
        <li><strong>Доступность</strong>: горячие клавиши, aria‑атрибуты, навигация с клавиатуры.</li>
      </ul>
    </section>

    <section id="sec-4-3-3">
      <h2>4.3.3. Выбор и обоснование технологий для реализации</h2>
      <h3>Frontend</h3>
      <ul>
        <li><strong>React + TypeScript</strong>. Библиотека для построения SPA и статическая типизация.
          <br><em>Обоснование</em>: зрелая экосистема, компонентный подход, высокая продуктивность, типобезопасность.
          <br><em>Как применяем</em>: модульная архитектура (страницы/виджеты/формы), типы для DTO API, React Router (ProtectedRoute/StaffRoute), хуки состояния/эффектов.</li>
        <li><strong>Ant Design</strong>. Набор UI‑компонентов (таблицы, формы, модальные окна, навигация).
          <br><em>Обоснование</em>: богатые enterprise‑компоненты, единый дизайн, большие таблицы.
          <br><em>Как применяем</em>: таблицы с пагинацией/фильтрами, Form с валидацией, Drawer/Modal для мастеров и карточек.</li>
        <li><strong>React Query</strong>. Клиент кэширования/синхронизации данных.
          <br><em>Почему</em>: кеширование, повтор запросов, статусы загрузки, оптимистичные апдейты.
          <br><em>Как применяем</em>: запросы к REST API, инвалидация кеша после мутаций (например, <code>catalog</code>, <code>me.reservations</code>, <code>invoices</code>, <code>payments</code>), фоновое обновление.</li>
        <li><strong>Recharts/ECharts</strong>. Библиотеки графиков/диаграмм.
          <br><em>Обоснование</em>: покрытие Line/Bar/Stacked/Pie/Heatmap, производительность и кастомизация.
          <br><em>Как применяем</em>: дашборд и отчёты (доход, заполняемость, aging, DSO, индексации).</li>
        <li><strong>Vite</strong>. Современный сборщик/dev‑сервер.
          <br><em>Обоснование</em>: быстрые сборки и HMR, простая конфигурация.
          <br><em>Как применяем</em>: сборка SPA, dev/prod конфиги, алиасы путей.</li>
      </ul>

      <h3>Backend</h3>
      <ul>
        <li><strong>NestJS (TypeScript)</strong>. Фреймворк для модульных REST‑сервисов.
          <br><em>Обоснование</em>: структурированность (controllers/services/guards), DI, тестируемость.
          <br><em>Как применяем</em>: модули (reservations, checkout, billing, payments, reports), guards с <code>@Roles</code>, pipes с <code>class-validator</code>, interceptors/filters.</li>
        <li><strong>Prisma ORM (PostgreSQL)</strong>. ORM‑слой к СУБД.
          <br><em>Обоснование</em>: высокая скорость разработки, типы, миграции, удобные связи.
          <br><em>Как применяем</em>: <code>schema.prisma</code>, отношения User/Tenant/Premise/Lease/Reservation/Invoice/Payment, проверки целостности.</li>
        <li><strong>PDFKit</strong>. Генерация PDF‑документов (счета/акты).
          <br><em>Обоснование</em>: гибкость рендеринга, контроль шрифтов.
          <br><em>Как применяем</em>: встроенный шрифт с кириллицей (Arial/DejaVu), корректная потоковая отдача с заголовками.</li>
        <li><strong>ExcelJS/CSV</strong>. Экспорт/импорт табличных данных.
          <br><em>Обоснование</em>: типовые форматы для обмена данными.
          <br><em>Как применяем</em>: экспорт XLSX/CSV, шаблоны импорта, парсинг загрузок, протокол ошибок.</li>
        <li><strong>Multer</strong>. Загрузка файлов (подписанные договоры, вложения лида).
          <br><em>Обоснование</em>: устойчивость и простота интеграции с NestJS.
          <br><em>Как применяем</em>: endpoints загрузки/скачивания, хранение метаданных.</li>
        <li><strong>Nodemailer (опционально)</strong>. Почтовые уведомления.
          <br><em>Обоснование</em>: распространённое SMTP‑решение.
          <br><em>Как применяем</em>: динамическая загрузка при наличии конфигурации; отправка уведомлений о счетах/событиях.</li>
      </ul>

      <h3>База данных</h3>
      <ul>
        <li><strong>PostgreSQL 14+</strong>. Реляционная СУБД.
          <br><em>Обоснование</em>: транзакционность, мощный SQL, индексы/partitions, матвью.
          <br><em>Как применяем</em>: схема 3НФ (справочники/факты), индексы по договорам/периодам, внешние ключи.</li>
        <li><strong>Миграции БД (Prisma Migrate)</strong>.
          <br><em>Почему</em>: управляемые изменения схемы с историей.
          <br><em>Как применяем</em>: версионирование изменений, <code>prisma migrate</code>/<code>db push</code>, seed‑данные.</li>
      </ul>

      <h3>Интеграции и файлы</h3>
      <ul>
        <li><strong>CSV/Excel</strong>: шаблоны импорта, парсинг, протокол ошибок.</li>
        <li><strong>DOCX</strong>: генерация документов по шаблонам (при необходимости).</li>
        <li><strong>PDF</strong>: счета/акты с поддержкой кириллицы.</li>
      </ul>

      <h3>Безопасность и доступ</h3>
      <ul>
        <li><strong>JWT/куки‑аутентификация</strong>. Механизмы токенов/сессий, совместимы со SPA.</li>
        <li><strong>RBAC</strong>. Разграничение прав (USER, OPERATOR, MANAGER, ADMIN, др.); политики доступа на эндпоинты и действия UI.</li>
        <li><strong>Аудит</strong>. Журналирование CRUD и ключевых событий (счета, платежи, операции с договорами).</li>
      </ul>
    </section>

    <section id="sec-4-2">
      <h2>4.2. Диаграммы вариантов использования (ролевая матрица)</h2>
      <p>Ниже перечислены варианты использования для ключевых ролей системы. Список составлен по фактическим страницам и эндпоинтам приложения. Для диаграмм UML используйте include/extend для выделенных под‑кейсов.</p>

      <h3>Акторы</h3>
      <ul>
        <li><strong>Guest</strong> — неавторизованный пользователь.</li>
        <li><strong>User</strong> — клиент/арендатор (личный кабинет: «Мои *»).</li>
        <li><strong>Operator</strong> — операционное сопровождение (STAFF).</li>
        <li><strong>Accountant</strong> — бухгалтер: права как у Operator, но без доступа к «Пользователи» и «Аудит», без настроек VAT и штрафов.</li>
        <li><strong>Manager/Exec</strong> — управленцы: чтение лидов/резерваций/дашборда.</li>
        <li><strong>Analyst</strong> — аналитик: отчёты/дашборд, чтение списков.</li>
        <li><strong>Admin</strong> — полные права + пользователи/роли/настройки/аудит.</li>
        <li><strong>Scheduler</strong> — системный планировщик (CRON биллинг).</li>
      </ul>

      <h3>Guest</h3>
      <ul>
        <li><strong>UC-G1</strong> Вход в систему.</li>
        <li><strong>UC-G2</strong> Просмотр каталога доступных помещений
          <br>include: UC-C1 Поиск/фильтрация, UC-C2 Сортировка.</li>
      </ul>

      <h3>User</h3>
      <ul>
        <li><strong>UC-U1</strong> Просмотр каталога (include: UC-C1/UC-C2).</li>
        <li><strong>UC-U2</strong> Создать резервацию помещения.</li>
        <li><strong>UC-U3</strong> Отменить свою резервацию.</li>
        <li><strong>UC-U4</strong> «Мои договоры» — список/детали.</li>
        <li><strong>UC-U5</strong> «Мои счета» — список/детали, скачивание PDF.</li>
        <li><strong>UC-U6</strong> «Мои платежи» — список/детали.</li>
        <li><strong>UC-U7</strong> «Мои резервации» — список/детали.</li>
      </ul>

      <h3>Operator</h3>
      <ul>
        <li><strong>UC-O1</strong> Дашборд/отчёты (просмотр).</li>
        <li><strong>UC-O2</strong> Управление резервациями (все брони): создать/отменить.</li>
        <li><strong>UC-O3</strong> Помещения — CRUD, импорт CSV.</li>
        <li><strong>UC-O4</strong> Арендаторы — CRUD, импорт CSV.</li>
        <li><strong>UC-O5</strong> Договоры — создать/редактировать, индексировать, загрузить подписанный файл; просматривать начисления/счета/платежи.
          <br>extend (ADMIN‑only): активация/расторжение/закрытие.</li>
        <li><strong>UC-O6</strong> Биллинг — запуск за период (генерация начислений и счетов).</li>
        <li><strong>UC-O7</strong> Счета — список/фильтр, экспорт/печать PDF.</li>
        <li><strong>UC-O8</strong> Платежи — создать, импорт, «неразнесённые», сопоставление со счетом, возврат.</li>
        <li><strong>UC-O9</strong> Leads — просмотр/создание/редактирование лидов, показов, вложений (если модуль включён).</li>
      </ul>

      <h3>Accountant</h3>
      <ul>
        <li><strong>UC-Ac1</strong> Дашборд/отчёты (просмотр).</li>
        <li><strong>UC-Ac2</strong> Резервации — чтение/создание/отмена.</li>
        <li><strong>UC-Ac3</strong> Помещения — CRUD, импорт CSV.</li>
        <li><strong>UC-Ac4</strong> Арендаторы — CRUD, импорт CSV.</li>
        <li><strong>UC-Ac5</strong> Договоры — создать/редактировать, индексировать, загрузить подписанный файл; (без операций активации/закрытия/расторжения).</li>
        <li><strong>UC-Ac6</strong> Биллинг — запуск за период.</li>
        <li><strong>UC-Ac7</strong> Платежи — создать, импорт, сопоставление, возврат.</li>
        <li><em>Нет доступа</em>: «Пользователи», «Аудит», настройки VAT, штрафы.</li>
      </ul>

      <h3>Manager / Exec</h3>
      <ul>
        <li><strong>UC-M1</strong> Дашборд/отчёты (просмотр).</li>
        <li><strong>UC-M2</strong> Резервации — чтение.</li>
        <li><strong>UC-M3</strong> Leads — чтение карточек/показов/вложений.</li>
      </ul>

      <h3>Analyst</h3>
      <ul>
        <li><strong>UC-An1</strong> Дашборд и отчётные списки (чтение).</li>
        <li><strong>UC-An2</strong> Резервации — чтение.</li>
      </ul>

      <h3>Admin</h3>
      <ul>
        <li><strong>UC-Adm1</strong> Управление пользователями и ролями.</li>
        <li><strong>UC-Adm2</strong> Аудит (журнал операций).</li>
        <li><strong>UC-Adm3</strong> Настройки VAT (создание записей).</li>
        <li><strong>UC-Adm4</strong> Договоры — активация, расторжение, закрытие.</li>
        <li><strong>UC-Adm5</strong> Все действия Operator.</li>
      </ul>

      <h3>Scheduler (системный)</h3>
      <ul>
        <li><strong>UC-S1</strong> Автоматический биллинг по расписанию (создание начислений/счетов, e‑mail уведомления при наличии SMTP).</li>
        <li><strong>UC-S2</strong> Авто‑истечение просроченных резерваций.</li>
      </ul>

      <h3>Общие под‑кейсы (для include/extend)</h3>
      <ul>
        <li><strong>UC-C1</strong> Поиск/фильтрация списков.</li>
        <li><strong>UC-C2</strong> Сортировка.</li>
        <li><strong>UC-R1</strong> Генерация PDF (счета).</li>
        <li><strong>UC-R2</strong> Экспорт Excel/CSV.</li>
        <li><strong>UC-P1</strong> Сопоставление платежа со счётом.</li>
      </ul>
    </section>

    <section id="sec-4-5">
      <h2>4.5. Руководство по работе с программным приложением</h2>
      <p>Это краткое руководство описывает основные действия пользователей разных ролей (USER, OPERATOR, MANAGER, ADMIN) в веб‑приложении управления арендой помещений.</p>
      <h3>Вход и навигация</h3>
      <ul>
        <li><strong>Вход</strong>: авторизуйтесь с помощью выданных логина и пароля.</li>
        <li><strong>Навигация</strong>: в меню доступны разделы согласно вашей роли. Для USER доступны «Каталог» и «Мои *» страницы. Для персонала — «Дашборд», «Помещения», «Договоры», «Счета», «Платежи», «Резервации» и др.</li>
      </ul>
      <h3>Каталог и бронирования (USER)</h3>
      <ul>
        <li><strong>Каталог</strong>: USER видит только доступные для аренды помещения (статус FREE).</li>
        <li><strong>Бронирование</strong>: выберите помещение → «Забронировать» → укажите дату «до». Бронь появится в «Мои резервации».</li>
        <li><strong>Отмена брони</strong>: разрешена только для собственных активных броней.</li>
      </ul>
      <h3>Аренда и оплата (Checkout, USER)</h3>
      <ul>
        <li><strong>Арендовать и оплатить</strong>: для помещения FREE создаются договор, счет и платеж одной операцией. Записи видны в «Мои счета» и «Мои платежи».</li>
        <li><strong>Требование</strong>: пользователь должен быть привязан к арендатору (tenantId), иначе операция будет отклонена.</li>
      </ul>
      <h3>Счета и платежи (STAFF/USER)</h3>
      <ul>
        <li><strong>Счета</strong>: персонал может формировать счета вручную или через биллинг. Пользователь видит свои счета на странице «Мои счета».</li>
        <li><strong>Платежи</strong>: отображаются в «Платежи» (персонал) и «Мои платежи» (USER). Доступ к оплате чужих счетов запрещен.</li>
        <li><strong>PDF счетов</strong>: доступны для скачивания, поддерживается кириллица.</li>
      </ul>
      <h3>Биллинг (STAFF)</h3>
      <ul>
        <li><strong>Запуск за период</strong>: формируются начисления и счета для ACTIVE‑договоров.</li>
        <li><strong>Проверка</strong>: фильтруйте по периоду/статусу и выгружайте отчеты.</li>
      </ul>
      <h3>Помещения и договоры (STAFF)</h3>
      <ul>
        <li><strong>Помещения</strong>: создание/редактирование/импорт CSV. Удаление невозможно при наличии связанных договоров.</li>
        <li><strong>Договоры</strong>: карточка договора, статусы, документы (PDF), операции по жизненному циклу согласно правам.</li>
      </ul>
    </section>

    <section id="sec-4-5-1">
      <h2>4.5.1. Руководство по установке</h2>
      <p>Ниже приведены шаги для локального запуска (Windows). Предполагается, что сервер — NestJS + Prisma + PostgreSQL, клиент — React + Vite.</p>
      <h3>Предварительные требования</h3>
      <ul>
        <li>Node.js 18+ (рекомендуется LTS)</li>
        <li>npm (или pnpm/yarn)</li>
        <li>Git</li>
        <li>PostgreSQL 14+ (локально) или Docker Desktop</li>
      </ul>
      <h3>1. Клонирование проекта</h3>
      <pre><code>git clone &lt;URL_репозитория&gt;
</code></pre>
      <h3>2. Настройка базы данных</h3>
      <p><strong>Вариант A — Docker (рекомендуется для быстрого старта)</strong></p>
      <pre><code>docker run --name landlord-pg -e POSTGRES_PASSWORD=postgres -e POSTGRES_USER=postgres -e POSTGRES_DB=landlord -p 5432:5432 -d postgres:15
</code></pre>
      <p><strong>Вариант B — Локальный PostgreSQL</strong>: создайте БД <code>landlord</code> пользователем <code>postgres</code> (или настройте свою строку подключения).</p>
      <h3>3. Сервер (NestJS)</h3>
      <pre><code># перейти в папку server
npm install
# создать .env (пример значений)
# DATABASE_URL=postgresql://postgres:postgres@localhost:5432/landlord?schema=public
# JWT_ACCESS_SECRET=supersecret
# PORT=3000
# CORS_ORIGIN=http://localhost:5173
# API_PREFIX=/api/v1
npx prisma generate
npx prisma db push
# опционально: npx prisma db seed
npm run start:dev
</code></pre>
      <h3>4. Клиент (React + Vite)</h3>
      <pre><code># перейти в папку client
npm install
# создать .env.development
# VITE_API_BASE_URL=http://localhost:3000/api/v1
npm run dev
</code></pre>
      <h3>5. Вход и проверка</h3>
      <ul>
        <li>Откройте клиент: <code>http://localhost:5173</code></li>
        <li>Убедитесь, что API отвечает: <code>http://localhost:3000/api/v1/health</code> (если реализовано)</li>
      </ul>
      <h3>Подсказки по устранению проблем</h3>
      <ul>
        <li><strong>Checkout 500</strong>: пользователю требуется привязка к арендатору (<code>tenantId</code>).</li>
        <li><strong>PDF кириллица</strong>: на Windows должен быть доступен шрифт Arial (<code>C:\Windows\Fonts\arial.ttf</code>); на Linux — DejaVu Sans.</li>
        <li><strong>Prisma ошибки схемы</strong>: выполните <code>npx prisma generate</code> и <code>npx prisma db push</code>, проверьте <code>DATABASE_URL</code>.</li>
      </ul>
    </section>
  </main>
  <section id="sec-6" style="padding:20px; max-width:980px; margin:0 auto 32px auto;">
    <h2>6. Перечень графического материала</h2>
    <ul>
      <li><strong>6.2.</strong> Схема информационной модели предметной области (плакат, 1 лист формата А3).</li>
      <li><strong>6.3.</strong> Архитектура программного приложения (плакат, 1 лист формата А3).</li>
      <li><strong>6.4.</strong> Модели представления программного приложения, схема алгоритма основного процесса предметной области (плакат, 1 лист формата А3).</li>
      <li><strong>6.5.</strong> Карта экранов пользовательского интерфейса (плакат, 1 лист формата А3).</li>
      <li><strong>6.6.</strong> Скриншот информационной панели программного приложения (плакат, 1 лист формата А3).</li>
    </ul>
    <figure>
      <figcaption>6.2. Схема информационной модели (пример, 1 рисунок)</figcaption>
      <img src="images/6.2-example.png" alt="Схема информационной модели — пример" style="width:100%;max-width:980px;border:1px solid #eee" />
    </figure>
    <figure>
      <figcaption>6.2. Схема информационной модели (наш проект)</figcaption>
      <img src="diagrams/6.2-info-model-detailed.svg" alt="ER‑диаграмма (наш проект)" style="width:100%;max-width:980px;border:1px solid #eee" />
    </figure>
    <figure>
      <figcaption>6.3. Архитектура программного приложения</figcaption>
      <img src="diagrams/6.3-architecture.svg" alt="Architecture" style="width:100%;max-width:980px;border:1px solid #eee" />
    </figure>
    <figure>
      <figcaption>6.4. Модели представления и схема алгоритма основного процесса</figcaption>
      <img src="diagrams/6.4-models-process.svg" alt="Models and Process" style="width:100%;max-width:980px;border:1px solid #eee" />
    </figure>
    <figure>
      <figcaption>6.5. Карта экранов пользовательского интерфейса</figcaption>
      <img src="diagrams/6.5-ui-map.svg" alt="UI Map" style="width:100%;max-width:980px;border:1px solid #eee" />
    </figure>
    <figure>
      <figcaption>6.6. Информационная панель (дашборд)</figcaption>
      <img src="diagrams/6.6-dashboard.svg" alt="Dashboard" style="width:100%;max-width:980px;border:1px solid #eee" />
    </figure>
  </section>
</body>
</html>
